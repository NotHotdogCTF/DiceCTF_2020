import angr
import claripy

#I thought this is the intended solution, but I wanted to try out angr

proj = angr.Project("./babymix", main_opts={'base_addr':0x00100000})

flag_len = 0x16

flag_chars = [claripy.BVS('flag_%d' % i, 8) for i in range(flag_len)]
flag = claripy.Concat(*flag_chars + [claripy.BVV(b'\n')])

state = proj.factory.full_init_state(args=['./babymix'], add_options=angr.options.unicorn, stdin=flag,)

for i in flag_chars: #printable chars
    state.solver.add(i >= ord('!'))
    state.solver.add(i <= ord('~'))
    stdin = flag

simgr = proj.factory.simulation_manager(state)
flag_addr = 0x00102225
avoid_addr = 0x00102238
simgr.explore(find=flag_addr, avoid=avoid_addr)

if (len(simgr.found) > 0):
        for i in simgr.found:
            print(i.posix.dumps(0x0)) #print stdin that contains flag
